From 738ad4ea9c4299125fd78fafcccc0a800467a42a Mon Sep 17 00:00:00 2001
From: Rohit Sharma <rohit.sharma@r2p.com>
Date: Thu, 16 Feb 2023 07:46:40 +0100
Subject: [PATCH 1/3] Add dtbo to memory for dynamic loading of device tree 
 overlays

Upstream-Status: Inappropriate [configuration]

Signed-off-by: Rohit Sharma <rohitsharmanotify@gmail.com>
---
 include/configs/sunxi-common.h | 33 +++++++++++++++++++++++++++++++++
 1 file changed, 33 insertions(+)

diff --git a/include/configs/sunxi-common.h b/include/configs/sunxi-common.h
index d2d70f0fc2..f94e70c910 100644
--- a/include/configs/sunxi-common.h
+++ b/include/configs/sunxi-common.h
@@ -276,6 +276,39 @@
 
 #include <config_distro_bootcmd.h>
 
+#undef CONFIG_BOOTCOMMAND
+#define CONFIG_BOOTCOMMAND \
+ 	"setenv resin_kernel_load_addr ${kernel_addr_r};" \
+ 	"run resin_set_kernel_root;" \
+ 	"setenv bootargs ${resin_kernel_root} rootfstype=ext4 rootwait console=$console;" \
+ 	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${resin_kernel_load_addr} uimage;" \
+ 	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${fdt_addr_r} dtb/${fdtfile};" \
+	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${fdtoverlay_addr_r} dtb/overlay/sun7i-a20-analog-codec.dtbo;" \
+	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${fdtoverlay_addr_r} dtb/overlay/sun7i-a20-can.dtbo;" \
+	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${fdtoverlay_addr_r} dtb/overlay/sun7i-a20-i2c1.dtbo;" \
+	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${fdtoverlay_addr_r} dtb/overlay/sun7i-a20-i2c2.dtbo;" \
+	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${fdtoverlay_addr_r} dtb/overlay/sun7i-a20-i2c3.dtbo;" \
+	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${fdtoverlay_addr_r} dtb/overlay/sun7i-a20-i2c4.dtbo;" \
+	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${fdtoverlay_addr_r} dtb/overlay/sun7i-a20-mmc2.dtbo;" \
+	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${fdtoverlay_addr_r} dtb/overlay/sun7i-a20-nand.dtbo;" \
+	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${fdtoverlay_addr_r} dtb/overlay/sun7i-a20-pps-gpio.dtbo;" \
+	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${fdtoverlay_addr_r} dtb/overlay/sun7i-a20-pwm.dtbo;" \
+	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${fdtoverlay_addr_r} dtb/overlay/sun7i-a20-spdif-out.dtbo;" \
+	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${fdtoverlay_addr_r} dtb/overlay/sun7i-a20-spi-add-cs1.dtbo;" \
+	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${fdtoverlay_addr_r} dtb/overlay/sun7i-a20-spi-jedec-nor.dtbo;" \
+	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${fdtoverlay_addr_r} dtb/overlay/sun7i-a20-spi-spidev.dtbo;" \
+	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${fdtoverlay_addr_r} dtb/overlay/sun7i-a20-uart2.dtbo;" \
+	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${fdtoverlay_addr_r} dtb/overlay/sun7i-a20-uart3.dtbo;" \
+	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${fdtoverlay_addr_r} dtb/overlay/sun7i-a20-uart4.dtbo;" \
+	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${fdtoverlay_addr_r} dtb/overlay/sun7i-a20-uart5.dtbo;" \
+	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${fdtoverlay_addr_r} dtb/overlay/sun7i-a20-uart6.dtbo;" \
+	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${fdtoverlay_addr_r} dtb/overlay/sun7i-a20-uart7.dtbo;" \
+	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${fdtoverlay_addr_r} dtb/overlay/sun7i-a20-w1-gpio.dtbo;" \
+	"fdt addr ${fdt_addr_r};" \
+	"fdt resize 8192;" \
+	"fdt apply ${fdtoverlay_addr_r};" \
+ 	"bootm ${resin_kernel_load_addr} - ${fdt_addr_r}"
+
 #ifdef CONFIG_USB_KEYBOARD
 #define CONSOLE_STDIN_SETTINGS \
 	"stdin=serial,usbkbd\0"
-- 
2.39.2

